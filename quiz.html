<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arkeoloji Uzmanlƒ±k Testi | FLL LEGOLOGLAR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <style>
        :root {
            --primary: #00b4d8; --secondary: #03045e; --earth: #935805;
            --bg: #f1f3f8; --white: #ffffff; --accent: #0096c7; --light-blue: #caf0f8;
        }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--secondary); display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .quiz-container { background: var(--white); border-radius: 20px; padding: 30px; width: 90%; max-width: 650px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border-top: 10px solid var(--earth); position: relative; }
        header { text-align: center; margin-bottom: 20px; }
        .progress-bar { height: 10px; background: #eee; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--earth); width: 0%; transition: 0.4s; }
        .options { list-style: none; padding: 0; }
        .options li { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 12px; cursor: pointer; border: 2px solid #eee; transition: 0.2s; font-weight: 500; }
        .options li:hover { background: var(--light-blue); border-color: var(--primary); }
        .btn-action { background: var(--secondary); color: white; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; text-decoration: none; display: inline-block; margin-top: 15px; }
        .back-link { text-decoration: none; color: var(--earth); font-weight: bold; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; transition: 0.3s; }
        .back-link:hover { opacity: 0.7; }

        /* Yeni Analiz Raporu Stilleri */
        .analysis-container { text-align: left; margin-top: 20px; max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 12px; padding: 15px; background: #fafafa; }
        .analysis-item { padding: 10px; border-bottom: 1px solid #eee; margin-bottom: 5px; }
        .analysis-item:last-child { border-bottom: none; }
        .q-text { font-weight: bold; display: block; margin-bottom: 5px; font-size: 14px; }
        .ans-wrong { color: #d62828; font-size: 13px; font-weight: 600; }
        .ans-correct { color: #2a9d8f; font-size: 13px; font-weight: 600; }
    </style>
</head>
<body>

<div class="quiz-container">
    <a href="index.html" class="back-link">
        <i class="fas fa-chevron-left"></i> Form Sayfasƒ±na Geri D√∂n
    </a>

    <div id="quiz-screen">
        <header>
            <h1>üèõÔ∏è Uzmanlƒ±k Testi</h1>
            <p id="q-counter">Y√ºkleniyor...</p>
            <div class="progress-bar"><div id="progress" class="progress-fill"></div></div>
        </header>
        <div id="question-text" style="font-size: 18px; font-weight: bold; margin-bottom: 20px;"></div>
        <ul id="options-list" class="options"></ul>
    </div>

    <div id="result-screen" style="display:none; text-align:center;">
        <h2>Test Tamamlandƒ±!</h2>
        <div id="final-score" style="font-size: 40px; font-weight: bold; color: var(--earth); margin: 20px 0;"></div>
        <div id="result-text"></div> <a href="index.html" class="btn-action">ƒ∞hbar Sayfasƒ±na D√∂n</a>
    </div>
</div>

<script>
    let quizBank = []; 
    let selectedQuestions = []; 
    let currentIdx = 0; 
    let score = 0;
    let userHistory = []; // Hatalarƒ± takip etmek i√ßin yeni dizi

    async function initQuiz() {
        try {
            const response = await fetch('sorular.json');
            quizBank = await response.json();
            selectedQuestions = quizBank.sort(() => 0.5 - Math.random()).slice(0, 20);
            showQuestion();
        } catch (e) { document.getElementById('question-text').innerText = "Hata: Sorular y√ºklenemedi."; }
    }

    function showQuestion() {
        const q = selectedQuestions[currentIdx];
        document.getElementById('q-counter').innerText = `Soru: ${currentIdx+1}/${selectedQuestions.length}`;
        document.getElementById('progress').style.width = (currentIdx/selectedQuestions.length*100) + "%";
        document.getElementById('question-text').innerText = q[0];
        const list = document.getElementById('options-list');
        list.innerHTML = "";
        
        for(let i=1; i<=3; i++) {
            const li = document.createElement('li');
            li.innerText = q[i];
            li.onclick = () => {
                const correctIdx = q[4];
                const isCorrect = (i-1 === correctIdx);

                // Ge√ßmi≈üi kaydet
                userHistory.push({
                    question: q[0],
                    userAns: q[i],
                    correctAns: q[correctIdx + 1],
                    correct: isCorrect
                });

                if(isCorrect) score++;
                
                currentIdx++;
                if(currentIdx < selectedQuestions.length) showQuestion(); else showResult();
            };
            list.appendChild(li);
        }
    }

    function showResult() {
        document.getElementById('quiz-screen').style.display='none';
        document.getElementById('result-screen').style.display='block';
        document.getElementById('final-score').innerText = `${score} / ${selectedQuestions.length}`;

        // Hata Analiz Raporunu Olu≈ütur
        let reportHtml = '<h3>Soru Analizi</h3><div class="analysis-container">';
        userHistory.forEach((item, idx) => {
            reportHtml += `
                <div class="analysis-item">
                    <span class="q-text">${idx+1}. ${item.question}</span>
                    ${item.correct ? 
                        `<span class="ans-correct"><i class="fas fa-check"></i> Doƒüru: ${item.userAns}</span>` : 
                        `<span class="ans-wrong"><i class="fas fa-times"></i> Senin Cevabƒ±n: ${item.userAns}</span><br>
                         <span class="ans-correct"><i class="fas fa-check"></i> Doƒüru Cevap: ${item.correctAns}</span>`
                    }
                </div>`;
        });
        reportHtml += '</div>';
        
        document.getElementById('result-text').innerHTML = reportHtml;
    }

    initQuiz();
</script>
</body>
</html>
