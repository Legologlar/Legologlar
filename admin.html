<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y√∂netici Paneli | FLL LEGOLOGLAR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --primary: #03045e; --accent: #0096c7; --bg: #f1f3f8; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; }
        .container { background: white; max-width: 900px; margin: auto; padding: 30px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #eee; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); overflow-y: auto; }
        .modal-content { background: white; margin: 5% auto; padding: 25px; border-radius: 15px; width: 90%; max-width: 600px; }
        .btn-view { background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
        .btn-del { background: #e63946; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div id="admin-container" class="container" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>üïµÔ∏è Y√∂netici Kontrol Paneli</h2>
        <button onclick="location.href='index.html'" style="padding:10px;">√áƒ±kƒ±≈ü Yap</button>
    </div>
    <div id="admin-list">Veriler y√ºkleniyor...</div>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <span style="float:right; cursor:pointer; font-size:24px;" onclick="closeDetail()">&times;</span>
        <h2>ƒ∞hbar Detayƒ±</h2>
        <hr>
        <div id="mBody"></div>
        <div id="mImages" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;"></div>
        <hr>
        <div id="modalFooter" style="margin-top:15px;"></div>
    </div>
</div>

<script>
    const DEPO_URL = "https://script.google.com/macros/s/AKfycbz6yl6eh7_E5nc00tTWTJdE9M2sOr-781p7tXqXvCZ9J7TVcYUVADok-HMRo_azlY8xmg/exec";
    const GIZLI_ANAHTAR = "AhMuzenKabin";
    let cachedReports = {};

    function sifreCoz(sifreliMetin) {
        try { 
            const bytes = CryptoJS.AES.decrypt(sifreliMetin, GIZLI_ANAHTAR); 
            return bytes.toString(CryptoJS.enc.Utf8); 
        } catch (e) { return null; }
    }

    async function loadAdmin() {
        const pass = prompt("Y√∂netici ≈ûifresi:");
        if (pass !== "1234") { alert("Yetkisiz giri≈ü!"); location.href="index.html"; return; }
        
        document.getElementById('admin-container').style.display = 'block';
        try {
            const res = await fetch(DEPO_URL);
            const data = await res.json();
            let html = "<table><tr><th>G√ºven</th><th>ƒ∞hbarcƒ±</th><th>Zaman</th><th>ƒ∞≈ülem</th></tr>";
            
            data.forEach((row, index) => {
                let fullEnc = "";
                for(let i=1; i<row.length; i++) if(row[i]) fullEnc += String(row[i]).trim().replace(/^'/, '');
                
                const decStr = sifreCoz(fullEnc);
                if(decStr) {
                    const item = JSON.parse(decStr);
                    cachedReports[index] = item;
                    html += `<tr>
                        <td>%${item.guven}</td>
                        <td>${item.ad}</td>
                        <td>${item.olayZamani}</td>
                        <td><button class="btn-view" onclick="openDetail(${index})">ƒ∞NCELE</button></td>
                    </tr>`;
                }
            });
            document.getElementById('admin-list').innerHTML = html + "</table>";
        } catch (e) { document.getElementById('admin-list').innerHTML = "Veri y√ºklenemedi."; }
    }

    function openDetail(index) {
        const item = cachedReports[index];
        document.getElementById('mBody').innerHTML = `
            <b>üë§ ƒ∞hbarcƒ±:</b> ${item.ad}<br>
            <b>üìÖ Zaman:</b> ${item.olayZamani}<br>
            <b>üìç Konum:</b> ${item.koordinat.lat}, ${item.koordinat.lng}<br>
            <b>üìù Mesaj:</b> <p>${item.detay}</p>
        `;
        document.getElementById('mImages').innerHTML = (item.fotolar || []).map(img => `<img src="${img}" style="width:100%; border-radius:5px;">`).join('');
        document.getElementById('modalFooter').innerHTML = `<button class="btn-del" onclick="deleteReport(${index})">ƒ∞HBARI Sƒ∞L</button>`;
        document.getElementById('detailModal').style.display = "block";
    }

    function closeDetail() { document.getElementById('detailModal').style.display = "none"; }
    
    async function deleteReport(index) {
        if(confirm("Silinsin mi?")) {
            await fetch(DEPO_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: "delete", rowIndex: index }) });
            location.reload();
        }
    }

    window.onload = loadAdmin;
</script>
</body>
</html>
